/*
 * app.c
 *
 *  Created on: Jan 16, 2025
 *      Author: ch.lee
 */

#include "app.h"
#include <math.h>

// 장치 선언
extern TIM_HandleTypeDef htim1;

// RGB LED PWM 설정 함수
void setDuty(uint8_t r, uint8_t g, uint8_t b) {
    htim1.Instance->CCR1 = r * 10;  // Red
    htim1.Instance->CCR2 = g * 10;  // Green
    htim1.Instance->CCR3 = b * 10;
}

void app() {
    // 타이머 장치 시작
    HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_1); // Red
    HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_2); // Green
    HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_3); // Blue

    while (1) {
        static int angle = 0;
        angle++;
        angle %= 360;

        uint8_t red   = sin(angle * M_PI / 180) * 50 + 49;
        uint8_t green = cos(angle * M_PI / 180) * 50 + 49;
        uint8_t blue  = sin((angle + 120) * M_PI / 180) * 50 + 49;

        setDuty(red, green, blue);

        HAL_Delay(10);
    }
}
